"use strict";(()=>{var e={};e.id=718,e.ids=[718],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},64685:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{POST:()=>m});var i=r(73278),o=r(45002),n=r(54877),s=r(71309),l=r(53524),d=r(16910);let p=new l.PrismaClient;async function m(e){try{let{googleToken:t,userData:r}=await e.json(),{email:a,name:i,googleId:o,picture:n}=r,l=await p.user.findFirst({where:{OR:[{email:a},{googleId:o}]},include:{role:!0,department:!0}});if(l)l.googleId||(l=await p.user.update({where:{id:l.id},data:{googleId:o,emailVerified:!0},include:{role:!0,department:!0}}));else{let[e,...t]=i.split(" "),r=t.join(" ")||"",n=await p.role.findFirst({where:{name:"Trainee"}});if(!n)return s.NextResponse.json({error:"Default role not found"},{status:500});l=await p.user.create({data:{employeeId:`GOOGLE_${Date.now()}`,firstName:e,lastName:r,email:a,googleId:o,roleId:n.id,isActive:!0,emailVerified:!0,profileColor:`#${Math.floor(16777215*Math.random()).toString(16)}`,profileInitials:`${e[0]}${r[0]||e[1]||""}`.toUpperCase()},include:{role:!0,department:!0}})}if(!l.isActive)return s.NextResponse.json({error:"Account is not active. Please contact administrator."},{status:403});await p.user.update({where:{id:l.id},data:{lastLogin:new Date}});let m=(0,d.RA)({id:l.id,employeeId:l.employeeId,firstName:l.firstName,lastName:l.lastName,email:l.email,role:l.role?.name||"Unknown",department:l.department?.name||"Unknown"});return s.NextResponse.json({token:m,user:{id:l.id,employeeId:l.employeeId,firstName:l.firstName,lastName:l.lastName,email:l.email,role:l.role?.name||"Unknown",department:l.department?.name||"Unknown",profileColor:l.profileColor,profileInitials:l.profileInitials}})}catch(e){return console.error("Google auth error:",e),s.NextResponse.json({error:"Authentication failed"},{status:500})}}let u=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/google/route",pathname:"/api/auth/google",filename:"route",bundlePath:"app/api/auth/google/route"},resolvedPagePath:"/workspace/app/api/auth/google/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:f,serverHooks:w}=u,h="/api/auth/google/route";function g(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},16910:(e,t,r)=>{r.d(t,{RA:()=>d,So:()=>p,c_:()=>s});var a=r(67390),i=r.n(a),o=r(93981);let n=new(r(53524)).PrismaClient,s=async e=>await o.ZP.hash(e,12),l=async(e,t)=>await o.ZP.compare(e,t),d=e=>{let t=process.env.JWT_SECRET||"fallback-secret-key";return i().sign({id:e.id,employeeId:e.employeeId,firstName:e.firstName,lastName:e.lastName,email:e.email,role:e.role,department:e.department},t,{expiresIn:"7d"})},p=async(e,t)=>{try{let r=await n.user.findUnique({where:{employeeId:e},include:{role:!0,department:!0}});if(!r||!r.password||!await l(t,r.password)||!r.isActive)return null;return{id:r.id,employeeId:r.employeeId,firstName:r.firstName,lastName:r.lastName,email:r.email,role:r.role.name,department:r.department?.name||"Unknown",isActive:r.isActive}}catch(e){return console.error("Authentication error:",e),null}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[787,833,990],()=>r(64685));module.exports=a})();
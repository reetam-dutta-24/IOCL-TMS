"use strict";(()=>{var e={};e.id=1718,e.ids=[1718],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},64685:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>h,requestAsyncStorage:()=>c,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{POST:()=>u});var a=r(73278),i=r(45002),n=r(54877),s=r(71309),l=r(53524),d=r(16910);let p=new l.PrismaClient;async function u(e){try{let{googleToken:t,userData:r}=await e.json(),{email:o,name:a,googleId:i,picture:n}=r,l=await p.user.findFirst({where:{OR:[{email:o},{googleId:i}]},include:{role:!0,department:!0}});if(l)l.googleId||(l=await p.user.update({where:{id:l.id},data:{googleId:i,emailVerified:!0},include:{role:!0,department:!0}}));else{let[e,...t]=a.split(" "),r=t.join(" ")||"",n=await p.role.findFirst({where:{name:"Trainee"}});if(!n)return s.NextResponse.json({error:"Default role not found"},{status:500});l=await p.user.create({data:{employeeId:`GOOGLE_${Date.now()}`,firstName:e,lastName:r,email:o,googleId:i,roleId:n.id,isActive:!0,emailVerified:!0,profileColor:`#${Math.floor(16777215*Math.random()).toString(16)}`,profileInitials:`${e[0]}${r[0]||e[1]||""}`.toUpperCase()},include:{role:!0,department:!0}})}if(!l.isActive)return s.NextResponse.json({error:"Account is not active. Please contact administrator."},{status:403});await p.user.update({where:{id:l.id},data:{lastLogin:new Date}});let u=(0,d.RA)({id:l.id,employeeId:l.employeeId,firstName:l.firstName,lastName:l.lastName,email:l.email,role:l.role?.name||"Unknown",department:l.department?.name||"Unknown"});return s.NextResponse.json({token:u,user:{id:l.id,employeeId:l.employeeId,firstName:l.firstName,lastName:l.lastName,email:l.email,role:l.role?.name||"Unknown",department:l.department?.name||"Unknown",profileColor:l.profileColor,profileInitials:l.profileInitials}})}catch(e){return console.error("Google auth error:",e),s.NextResponse.json({error:"Authentication failed"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/google/route",pathname:"/api/auth/google",filename:"route",bundlePath:"app/api/auth/google/route"},resolvedPagePath:"/workspace/app/api/auth/google/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:f,serverHooks:g}=m,w="/api/auth/google/route";function h(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},16910:(e,t,r)=>{r.d(t,{Gv:()=>s,RA:()=>l,So:()=>d,c_:()=>n});var o=r(67390),a=r(93981);let i=new(r(53524)).PrismaClient,n=async e=>await a.vp(e,12),s=async(e,t)=>await a.qu(e,t),l=e=>{let t=process.env.JWT_SECRET||"fallback-secret-key";return o.sign({id:e.id,employeeId:e.employeeId,firstName:e.firstName,lastName:e.lastName,email:e.email,role:e.role,department:e.department},t,{expiresIn:"7d"})},d=async(e,t)=>{try{console.log(`🔍 Authentication attempt for Employee ID: ${e}`);let r=await i.user.findUnique({where:{employeeId:e},include:{role:!0,department:!0}});if(!r)return console.log(`❌ User not found for Employee ID: ${e}`),null;if(!r.password)return console.log(`❌ User ${e} has no password set`),null;console.log(`✅ User found: ${r.firstName} ${r.lastName} (${r.employeeId})`),console.log(`✅ User active: ${r.isActive}`),console.log(`✅ Password hash exists: ${!!r.password}`);let o=await s(t,r.password);if(console.log(`🔑 Password validation result: ${o}`),!o)return console.log(`❌ Invalid password for user: ${e}`),null;if(!r.isActive)return console.log(`❌ User ${e} is not active`),null;return{id:r.id,employeeId:r.employeeId,firstName:r.firstName,lastName:r.lastName,email:r.email,role:r.role.name,department:r.department?.name||"Unknown",isActive:r.isActive}}catch(e){return console.error("Authentication error:",e),null}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[7787,4833,5990],()=>r(64685));module.exports=o})();
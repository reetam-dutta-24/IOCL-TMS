"use strict";(()=>{var e={};e.id=1813,e.ids=[1813],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},87310:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>c});var r={};a.r(r),a.d(r,{GET:()=>i});var s=a(73278),n=a(45002),o=a(54877),l=a(71309);let d=new(a(53524)).PrismaClient;async function i(e){try{console.log("\uD83D\uDD0D Fetching coordinator dashboard data...");let e=await d.accessRequest.findMany({include:{requestedRole:!0,department:!0},orderBy:{requestedAt:"desc"}});console.log(`ðŸ“Š Found ${e.length} total requests`);let t=await d.user.findMany({select:{employeeId:!0,isActive:!0}}),a=new Map;t.forEach(e=>{a.set(e.employeeId,e.isActive)});let r=e.length,s=e.filter(e=>"PENDING"===e.status).length,n=e.filter(e=>"APPROVED"===e.status).length,o=e.filter(e=>"REJECTED"===e.status).length,i=e.filter(e=>"APPROVED"===e.status&&a.has(e.employeeId)&&a.get(e.employeeId)).length,u=new Date().getMonth(),p=new Date().getFullYear(),c=e.filter(e=>{let t=new Date(e.requestedAt);return t.getMonth()===u&&t.getFullYear()===p&&("APPROVED"===e.status||"REJECTED"===e.status)}).length,h=e.filter(e=>"APPROVED"===e.status||"REJECTED"===e.status),g=0;if(h.length>0){let e=h.reduce((e,t)=>{let a=new Date(t.requestedAt),r=t.reviewedAt?new Date(t.reviewedAt):new Date,s=Math.abs(r.getTime()-a.getTime());return e+Math.ceil(s/864e5)},0);g=Math.round(e/h.length*10)/10}let m=new Date;m.setDate(m.getDate()-1);let D=e.filter(e=>"PENDING"===e.status&&new Date(e.requestedAt)<=m).length,P=[];for(let t=5;t>=0;t--){let a=new Date;a.setMonth(a.getMonth()-t);let r=a.toLocaleString("default",{month:"short"}),s=a.getFullYear(),n=a.getMonth(),o=e.filter(e=>{let t=new Date(e.requestedAt);return t.getMonth()===n&&t.getFullYear()===s}),l=o.length,d=o.filter(e=>"APPROVED"===e.status||"REJECTED"===e.status).length,i=o.filter(e=>"APPROVED"===e.status).length;P.push({month:r,submitted:l,processed:d,routed:i})}let f=(await d.department.findMany()).map(t=>{let r=e.filter(e=>e.departmentId===t.id);return{department:t.name,pending:r.filter(e=>"PENDING"===e.status).length,active:r.filter(e=>"APPROVED"===e.status&&a.has(e.employeeId)&&a.get(e.employeeId)).length,completed:r.filter(e=>"APPROVED"===e.status).length}}),A=e.slice(0,10).map(e=>{let t=a.has(e.employeeId)&&a.get(e.employeeId);return{id:e.id,employeeId:e.employeeId||`REQ${e.id.toString().padStart(3,"0")}`,applicantName:`${e.firstName} ${e.lastName}`,department:e.department?.name||"N/A",requestType:e.requestedRole?.name||"Unknown Role",status:"PENDING"===e.status?"Pending Review":"APPROVED"===e.status?t?"Active User":"Approved":"Rejected",submittedDate:e.requestedAt.toISOString().split("T")[0],urgency:new Date(e.requestedAt)<=m?"High":"Normal",nextAction:"PENDING"===e.status?"Initial Review Required":"APPROVED"===e.status?t?"Monitor Progress":"User Account Pending":"Request Completed"}}),R={totalRequests:r,pendingRequests:s,activeRequests:i,completedRequests:n,departmentRequests:e.filter(e=>e.departmentId).length,monthlyProcessed:c,avgProcessingTime:g>0?`${g} days`:"N/A",urgentRequests:D};return console.log("âœ… Successfully fetched coordinator dashboard data:",{totalRequests:r,pendingRequests:s,activeRequests:i,monthlyProcessed:c,avgProcessingDays:g}),l.NextResponse.json({stats:R,metrics:{statusDistribution:[{name:"Pending Review",value:s,color:"#f59e0b"},{name:"Approved",value:n,color:"#10b981"},{name:"Active Users",value:i,color:"#3b82f6"},{name:"Rejected",value:o,color:"#ef4444"}],monthlyTrends:P,departmentBreakdown:f},recentRequests:A})}catch(e){return console.error("\uD83D\uDCA5 Failed to fetch coordinator dashboard data:",e),l.NextResponse.json({error:"Failed to fetch dashboard data"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/coordinator-dashboard/route",pathname:"/api/coordinator-dashboard",filename:"route",bundlePath:"app/api/coordinator-dashboard/route"},resolvedPagePath:"/workspace/app/api/coordinator-dashboard/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:h}=u,g="/api/coordinator-dashboard/route";function m(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:c})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[7787,4833],()=>a(87310));module.exports=r})();
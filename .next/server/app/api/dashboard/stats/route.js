"use strict";(()=>{var e={};e.id=41,e.ids=[41],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},17951:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>q,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{GET:()=>p,dynamic:()=>d});var a=r(49303),n=r(88716),o=r(60670),i=r(87070),u=r(83493);let d="force-dynamic";async function p(e){try{let t=e.nextUrl.searchParams.get("role"),[r,s,a,n,o,d,p,c]=await Promise.all([u._.internshipRequest.count(),u._.internshipRequest.count({where:{status:"SUBMITTED"}}),u._.internshipRequest.count({where:{status:"APPROVED"}}),u._.internshipRequest.count({where:{status:"REJECTED"}}),u._.user.count({where:{role:{name:"Mentor"}}}),u._.user.count({where:{role:{name:"Mentor"},isActive:!0}}),u._.user.count(),u._.user.count({where:{isActive:!0}})]),m=(await u._.internshipRequest.findMany({take:5,orderBy:{createdAt:"desc"},include:{submitter:{select:{firstName:!0,lastName:!0}},department:{select:{name:!0}}}})).map(e=>({id:e.id,type:"request",title:`New request from ${e.traineeName}`,description:`Request ${e.requestNumber} from ${e.institutionName}`,user:`${e.submitter.firstName} ${e.submitter.lastName}`,timestamp:e.createdAt.toISOString(),status:e.status,department:e.department?.name||"Unknown"})),l={};if("L&D HoD"===t||"Admin"===t)l={totalRequests:r,pendingRequests:s,approvedRequests:a,rejectedRequests:n,totalMentors:o,activeMentors:d,totalUsers:p,activeUsers:c};else if("L&D Coordinator"===t)l={totalRequests:r,pendingRequests:s,approvedRequests:a,totalMentors:o,activeMentors:d};else if("Mentor"===t){let e=await u._.mentorAssignment.count({where:{mentor:{role:{name:"Mentor"}},assignmentStatus:"ACTIVE"}});l={totalRequests:e,pendingRequests:0,approvedRequests:e,totalMentors:1,activeMentors:1}}let h=await u._.internshipRequest.groupBy({by:["preferredDepartment"],_count:{id:!0},where:{preferredDepartment:{not:null}}}),w=await Promise.all(h.map(async e=>{let t=await u._.department.findUnique({where:{id:e.preferredDepartment}});return{department:t?.name||"Unknown",count:e._count.id}})),q=new Date;q.setMonth(q.getMonth()-6);let g=await u._.internshipRequest.groupBy({by:["createdAt"],_count:{id:!0},where:{createdAt:{gte:q}},orderBy:{createdAt:"asc"}});return i.NextResponse.json({success:!0,data:{stats:l,recentActivities:m,departmentBreakdown:w,monthlyTrends:g.map(e=>({month:e.createdAt.toISOString().split("T")[0].substring(0,7),count:e._count.id}))}})}catch(e){return console.error("Dashboard stats error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/dashboard/stats/route",pathname:"/api/dashboard/stats",filename:"route",bundlePath:"app/api/dashboard/stats/route"},resolvedPagePath:"/workspace/app/api/dashboard/stats/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:l,serverHooks:h}=c,w="/api/dashboard/stats/route";function q(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:l})}},83493:(e,t,r)=>{r.d(t,{_:()=>a});let s=require("@prisma/client"),a=globalThis.prisma??new s.PrismaClient({log:["query","error","warn"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(17951));module.exports=s})();
"use strict";(()=>{var e={};e.id=14,e.ids=[14],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},68786:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{PATCH:()=>d});var a=t(73278),o=t(45002),i=t(54877),n=t(71309),u=t(53524),c=t(16910);let l=new u.PrismaClient;async function d(e,{params:r}){try{let{action:t,reviewComment:s,reviewerId:a}=await e.json(),o=parseInt(r.id);if(!t||!["approve","reject"].includes(t))return n.NextResponse.json({error:"Invalid action. Must be 'approve' or 'reject'"},{status:400});let i=await l.accessRequest.findUnique({where:{id:o},include:{requestedRole:!0,department:!0}});if(!i)return n.NextResponse.json({error:"Access request not found"},{status:404});if("PENDING"!==i.status)return n.NextResponse.json({error:"Access request has already been processed"},{status:400});if(await l.accessRequest.update({where:{id:o},data:{status:"approve"===t?"APPROVED":"REJECTED",reviewedAt:new Date,reviewComment:s||null,reviewedBy:a||null}}),"approve"===t)try{let e="Welcome@123",r=await (0,c.c_)(e),s=await l.user.create({data:{employeeId:i.employeeId,firstName:i.firstName,lastName:i.lastName,email:i.email,phone:i.phone||null,password:r,roleId:i.requestedRoleId,departmentId:i.departmentId,isActive:!0,profileColor:`#${Math.floor(16777215*Math.random()).toString(16)}`,profileInitials:`${i.firstName[0]}${i.lastName[0]}`.toUpperCase()}});return n.NextResponse.json({success:!0,message:`Access request ${t}d successfully and user account created`,userId:s.id,defaultPassword:e})}catch(e){return console.error("Error creating user account:",e),await l.accessRequest.update({where:{id:o},data:{status:"PENDING",reviewedAt:null,reviewComment:"Failed to create user account. Please try again.",reviewedBy:null}}),n.NextResponse.json({error:"Failed to create user account after approval"},{status:500})}return n.NextResponse.json({success:!0,message:`Access request ${t}d successfully`})}catch(e){return console.error("Access request update error:",e),n.NextResponse.json({error:"Failed to update access request"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/access-requests/[id]/route",pathname:"/api/access-requests/[id]",filename:"route",bundlePath:"app/api/access-requests/[id]/route"},resolvedPagePath:"/workspace/app/api/access-requests/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:f}=p,q="/api/access-requests/[id]/route";function v(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:w})}},16910:(e,r,t)=>{t.d(r,{RA:()=>c,So:()=>l,c_:()=>n});var s=t(67390),a=t.n(s),o=t(93981);let i=new(t(53524)).PrismaClient,n=async e=>await o.ZP.hash(e,12),u=async(e,r)=>await o.ZP.compare(e,r),c=e=>{let r=process.env.JWT_SECRET||"fallback-secret-key";return a().sign({id:e.id,employeeId:e.employeeId,firstName:e.firstName,lastName:e.lastName,email:e.email,role:e.role,department:e.department},r,{expiresIn:"7d"})},l=async(e,r)=>{try{let t=await i.user.findUnique({where:{employeeId:e},include:{role:!0,department:!0}});if(!t||!t.password||!await u(r,t.password)||!t.isActive)return null;return{id:t.id,employeeId:t.employeeId,firstName:t.firstName,lastName:t.lastName,email:t.email,role:t.role.name,department:t.department?.name||"Unknown",isActive:t.isActive}}catch(e){return console.error("Authentication error:",e),null}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[787,833,990],()=>t(68786));module.exports=s})();
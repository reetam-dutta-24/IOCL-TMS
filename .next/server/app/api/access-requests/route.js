"use strict";(()=>{var e={};e.id=8540,e.ids=[8540],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},52206:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>f,patchFetch:()=>R,requestAsyncStorage:()=>x,routeModule:()=>q,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var t={};r.r(t),r.d(t,{GET:()=>l,POST:()=>d});var a=r(73278),o=r(45002),u=r(54877),i=r(71309),n=r(53524),c=r(56742);let p=new n.PrismaClient;async function d(e){try{let{firstName:s,lastName:r,email:t,phone:a,employeeId:o,requestedRoleId:u,departmentId:n,institutionName:c,purpose:d}=await e.json();if(await p.user.findUnique({where:{email:t}}))return i.NextResponse.json({error:"An account with this email already exists"},{status:400});if(await p.user.findUnique({where:{employeeId:o}}))return i.NextResponse.json({error:"This Employee ID is already registered"},{status:400});if(await p.accessRequest.findFirst({where:{OR:[{email:t},{employeeId:o}],status:"PENDING"}}))return i.NextResponse.json({error:"A pending access request already exists for this email or Employee ID"},{status:400});let l=await p.accessRequest.create({data:{firstName:s,lastName:r,email:t,phone:a,employeeId:o,requestedRoleId:parseInt(u),departmentId:n?parseInt(n):null,institutionName:c,purpose:d,status:"PENDING"},include:{requestedRole:!0,department:!0}});return i.NextResponse.json({success:!0,message:"Access request submitted successfully",requestId:l.id})}catch(e){return console.error("Access request submission error:",e),i.NextResponse.json({error:"Failed to submit access request"},{status:500})}}async function l(e){try{let e=await p.accessRequest.findMany({include:{requestedRole:!0,department:!0,reviewer:{select:{firstName:!0,lastName:!0,email:!0}}},orderBy:{requestedAt:"desc"}});return i.NextResponse.json(e)}catch(e){return console.error("Failed to fetch access requests:",e),i.NextResponse.json({error:"Failed to fetch access requests"},{status:500})}}c.createTransport({host:process.env.SMTP_HOST||"smtp.gmail.com",port:587,secure:!1,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}});let q=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/access-requests/route",pathname:"/api/access-requests",filename:"route",bundlePath:"app/api/access-requests/route"},resolvedPagePath:"/workspace/app/api/access-requests/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:x,staticGenerationAsyncStorage:m,serverHooks:h}=q,f="/api/access-requests/route";function R(){return(0,u.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}}};var s=require("../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[7787,4833,6742],()=>r(52206));module.exports=t})();
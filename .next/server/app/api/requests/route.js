"use strict";(()=>{var e={};e.id=303,e.ids=[303],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},28052:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>N,staticGenerationAsyncStorage:()=>q});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>l,dynamic:()=>p});var i=r(49303),a=r(88716),n=r(60670),u=r(87070),o=r(83493);let p="force-dynamic";async function m(e){try{let t=e.nextUrl.searchParams,r=t.get("status"),s=t.get("department"),i={};r&&"all"!==r&&(i.status=r),s&&"all"!==s&&(i.department={name:s});let a=(await o._.internshipRequest.findMany({where:i,include:{submitter:{select:{firstName:!0,lastName:!0,employeeId:!0}},department:{select:{name:!0,code:!0}}},orderBy:{createdAt:"desc"}})).map(e=>({id:e.id,requestNumber:e.requestNumber,traineeName:e.traineeName,traineeEmail:e.traineeEmail,traineePhone:e.traineePhone,institutionName:e.institutionName,courseDetails:e.courseDetails,internshipDuration:e.internshipDuration,preferredDepartment:e.department?.name||"Not specified",requestDescription:e.requestDescription,status:e.status,priority:e.priority,submittedDate:e.createdAt.toISOString().split("T")[0],requestedBy:`${e.submitter.firstName} ${e.submitter.lastName} (${e.submitter.employeeId})`}));return u.NextResponse.json({success:!0,data:a,total:a.length})}catch(e){return console.error("GET requests error:",e),u.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e){try{let{traineeName:t,traineeEmail:r,traineePhone:s,institutionName:i,courseDetails:a,internshipDuration:n,preferredDepartment:p,requestDescription:m,priority:l="MEDIUM",requestedBy:d}=await e.json();if(!t||!i||!n||!d)return u.NextResponse.json({error:"Missing required fields"},{status:400});let c=null;if(p){let e=await o._.department.findFirst({where:{name:p}});c=e?.id||null}let q=await o._.user.findUnique({where:{employeeId:d}});if(!q)return u.NextResponse.json({error:"Invalid submitter employee ID"},{status:400});let N=await o._.internshipRequest.count(),h=`REQ${String(N+1).padStart(3,"0")}`,y=await o._.internshipRequest.create({data:{requestNumber:h,traineeName:t,traineeEmail:r,traineePhone:s,institutionName:i,courseDetails:a,internshipDuration:parseInt(n),preferredDepartment:c,requestDescription:m,priority:l,status:"SUBMITTED",requestedBy:q.id},include:{submitter:{select:{firstName:!0,lastName:!0,employeeId:!0}},department:{select:{name:!0,code:!0}}}}),f={id:y.id,requestNumber:y.requestNumber,traineeName:y.traineeName,traineeEmail:y.traineeEmail,traineePhone:y.traineePhone,institutionName:y.institutionName,courseDetails:y.courseDetails,internshipDuration:y.internshipDuration,preferredDepartment:y.department?.name||"Not specified",requestDescription:y.requestDescription,status:y.status,priority:y.priority,submittedDate:y.createdAt.toISOString().split("T")[0],requestedBy:`${y.submitter.firstName} ${y.submitter.lastName} (${y.submitter.employeeId})`};return u.NextResponse.json({success:!0,data:f,message:"Request created successfully"},{status:201})}catch(e){return console.error("POST requests error:",e),u.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/requests/route",pathname:"/api/requests",filename:"route",bundlePath:"app/api/requests/route"},resolvedPagePath:"/workspace/app/api/requests/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:q,serverHooks:N}=d,h="/api/requests/route";function y(){return(0,n.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:q})}},83493:(e,t,r)=>{r.d(t,{_:()=>i});let s=require("@prisma/client"),i=globalThis.prisma??new s.PrismaClient({log:["query","error","warn"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(28052));module.exports=s})();